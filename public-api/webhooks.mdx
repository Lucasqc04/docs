---
title: Webhooks
---

Se o pagamento for criado com `webhookUrl`, a API envia webhooks:
- `payment.created`: enviado após criação do pagamento.
- `payment.status_changed`: enviado em transições de status do pagamento.

## Assinatura digital de webhooks

Todos os webhooks enviados pela API pública são assinados digitalmente para garantir autenticidade e integridade das notificações.

### Como funciona

Ao criar um novo token de API pública, você recebe um **webhookSecret** exclusivo. Todos os webhooks enviados para a URL cadastrada conterão um header HTTP chamado `x-webhook-signature`.

O valor desse header é um **HMAC-SHA256** do corpo bruto do POST, usando o seu `webhookSecret` como chave.

### Validando a assinatura

Para validar a assinatura, calcule o HMAC-SHA256 do corpo recebido com o seu `webhookSecret` e compare com o valor do header `x-webhook-signature`.

Exemplo em Node.js:

```javascript
const crypto = require('crypto');

function validateWebhookSignature(body, signature, secret) {
  const hmac = crypto.createHmac('sha256', secret);
  hmac.update(body);
  const calculatedSignature = hmac.digest('hex');
  
  return calculatedSignature === signature;
}

// No seu endpoint de webhook
app.post('/webhook', (req, res) => {
  const signature = req.headers['x-webhook-signature'];
  const body = JSON.stringify(req.body);
  
  if (!validateWebhookSignature(body, signature, process.env.WEBHOOK_SECRET)) {
    return res.status(401).send('Invalid signature');
  }
  
  // Processar webhook legítimo
  console.log('Webhook válido:', req.body);
  res.status(200).send('OK');
});
```

<Warning>
Implemente a validação da assinatura em seu endpoint de webhook para garantir que só processa notificações legítimas.
</Warning>


### Payload de Webhook

Campos enviados em ambos os eventos:

| Campo         | Tipo     | Descrição                                  |
|---------------|----------|--------------------------------------------|
| `id`          | string   | ID do pagamento                            |
| `status`      | string   | Status atual do pagamento                  |
| `amount`      | number   | Valor do pagamento (BRL)                   |
| `storeId`     | string   | ID da loja                                 |
| `createdAt`   | string   | ISO datetime de criação                    |
| `webhookUrl`  | string?  | URL configurada para o webhook (se houver) |
| `observation` | string?  | Observação do pagamento                    |
| `email`       | string   | E‑mail associado ao pagamento              |
| `qrCodeUrl`   | string?  | URL do QR Code                             |
| `qrCopyPaste` | string?  | Conteúdo do QR Copia e Cola                |

Campo adicional em `payment.status_changed`:

| Campo            | Tipo   | Descrição                 |
|------------------|--------|---------------------------|
| `previousStatus` | string | Status anterior do pago   |

Exemplo `payment.created`:

```json
{
  "event": "payment.created",
  "id": "pay_123",
  "status": "pending",
  "amount": 150.0,
  "storeId": "store_abc",
  "createdAt": "2025-12-16T15:00:00.000Z",
  "webhookUrl": "https://example.com/webhook",
  "observation": "Pedido #9876",
  "email": "cliente@example.com",
  "qrCodeUrl": "https://.../qrcode.png",
  "qrCopyPaste": "000201010212..."
}
```

Exemplo `payment.status_changed`:

```json
{
  "event": "payment.status_changed",
  "id": "pay_123",
  "status": "approved",
  "previousStatus": "pending",
  "amount": 150.0,
  "storeId": "store_abc",
  "createdAt": "2025-12-16T15:00:00.000Z",
  "webhookUrl": "https://example.com/webhook",
  "observation": "Pedido #9876",
  "email": "cliente@example.com",
  "qrCodeUrl": "https://.../qrcode.png",
  "qrCopyPaste": "000201010212..."
}
```
