---
title: Webhooks
---

Se o pagamento for criado com `webhookUrl`, a API envia webhooks:
- `payment.created`: enviado após criação do pagamento.
- `payment.status_changed`: enviado em transições de status do pagamento.

## Eventos suportados

A API envia webhooks para os seguintes eventos:

- **`payment.created`**: enviado após a criação do pagamento
- **`payment.status_changed`**: enviado em transições de status do pagamento

## Assinatura digital de webhooks

Todos os webhooks enviados pela API pública são assinados digitalmente para garantir autenticidade e integridade das notificações.

### Headers enviados

Cada webhook inclui os seguintes headers HTTP:

| Header | Descrição |
|--------|-----------|
| `X-Paguebit-Signature` | Assinatura HMAC-SHA256 do payload |
| `X-Paguebit-Timestamp` | Timestamp Unix da requisição |
| `X-Paguebit-Event-Id` | ID único do evento |

### Como funciona

O `webhookSecret` é configurado por loja ao criar um token de API pública. A assinatura é gerada no seguinte formato:

```
signed_payload = "{timestamp}.{raw_body}"
signature = HMAC_SHA256(webhookSecret, signed_payload)
```

<Warning>
A assinatura do webhook é gerada a partir do **corpo bruto (raw body)** da requisição, exatamente como enviado no POST, concatenado com o timestamp no formato `{timestamp}.{raw_body}`. Não faça `JSON.parse` + `JSON.stringify` no corpo antes de validar, pois isso pode alterar a formatação e invalidar a assinatura.
</Warning>

### Validando a assinatura

Para validar a assinatura, calcule o HMAC-SHA256 do payload assinado com o seu `webhookSecret` e compare com o valor do header `X-Paguebit-Signature`.

Exemplo em Node.js:

```javascript
const crypto = require('crypto');

function validateWebhookSignature(body, timestamp, signature, secret) {
  const signedPayload = `${timestamp}.${body}`;
  const hmac = crypto.createHmac('sha256', secret);
  hmac.update(signedPayload);
  const calculatedSignature = hmac.digest('hex');
  
  return calculatedSignature === signature;
}

// No seu endpoint de webhook
app.post('/webhook', (req, res) => {
  const signature = req.headers['x-paguebit-signature'];
  const timestamp = req.headers['x-paguebit-timestamp'];
  const body = JSON.stringify(req.body);
  
  if (!validateWebhookSignature(body, timestamp, signature, process.env.WEBHOOK_SECRET)) {
    return res.status(401).send('Invalid signature');
  }
  
  // Processar webhook legítimo
  console.log('Webhook válido:', req.body);
  res.status(200).send('OK');
});
```

<Warning>
Implemente a validação da assinatura em seu endpoint de webhook para garantir que só processa notificações legítimas.
</Warning>

## Payload de webhook

Campos enviados em ambos os eventos:

| Campo         | Tipo     | Descrição                                  |
|---------------|----------|-------------------------------------------|
| `event`       | string   | Tipo do evento (`payment.created` ou `payment.status_changed`) |
| `id`          | string   | ID do pagamento                            |
| `status`      | string   | Status atual do pagamento                  |
| `amount`      | number   | Valor do pagamento (BRL)                   |
| `storeId`     | string   | ID da loja                                 |
| `createdAt`   | string   | ISO datetime de criação                    |
| `email`       | string   | E‑mail associado ao pagamento              |
| `observation` | string?  | Observação do pagamento                    |
| `qrCodeUrl`   | string?  | URL do QR Code                             |
| `qrCopyPaste` | string?  | Conteúdo do QR Copia e Cola                |
| `isPublic`    | boolean  | Indica se o pagamento é público            |

Campo adicional em `payment.status_changed`:

| Campo            | Tipo   | Descrição                 |
|------------------|--------|---------------------------|
| `previousStatus` | string | Status anterior do pagamento |

<Note>
O campo `webhookUrl` não é incluído no payload dos webhooks, pois o webhook é uma notificação e não um espelhamento do endpoint GET. O `webhookUrl` continua disponível nos endpoints de leitura (GET).
</Note>

Exemplo `payment.created`:

```json
{
  "event": "payment.created",
  "id": "pay_123",
  "status": "pending",
  "amount": 150.0,
  "storeId": "store_abc",
  "createdAt": "2025-12-16T15:00:00.000Z",
  "observation": "Pedido #9876",
  "email": "cliente@example.com",
  "qrCodeUrl": "https://.../qrcode.png",
  "qrCopyPaste": "000201010212...",
  "isPublic": true
}
```

Exemplo `payment.status_changed`:

```json
{
  "event": "payment.status_changed",
  "id": "pay_123",
  "status": "approved",
  "previousStatus": "pending",
  "amount": 150.0,
  "storeId": "store_abc",
  "createdAt": "2025-12-16T15:00:00.000Z",
  "observation": "Pedido #9876",
  "email": "cliente@example.com",
  "qrCodeUrl": "https://.../qrcode.png",
  "qrCopyPaste": "000201010212...",
  "isPublic": true
}
```

## Testando webhooks

Para testar a integração de webhooks, recomendamos o uso das seguintes ferramentas:

- **[webhook.site](https://webhook.site)**: Gera URLs temporárias para inspecionar webhooks recebidos
- **[ngrok](https://ngrok.com)**: Cria túneis seguros para testar webhooks localmente

Essas ferramentas permitem visualizar os headers, payload e validar a assinatura dos webhooks antes de implementar em produção.
